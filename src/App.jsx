import { useRef, useEffect } from 'react';
import { Box, Flex, IconButton, Tooltip, useColorMode } from '@chakra-ui/react';
import { SunIcon, MoonIcon } from '@chakra-ui/icons';
import rough from 'roughjs/bin/rough';

import * as ui from './config/ui';
import './App.css';

export default function App() {
  const logotype = useRef();
  const { colorMode, toggleColorMode } = useColorMode();
  const isLightMode = colorMode == 'light';
  const modeId = 'mode';
  const modeLabel = `Switch to ${isLightMode ? 'dark' : 'light'} mode`;
  const handleKeyPress = (event, commitAction, cancelAction) => {
    if (event.key == 'Enter') {
      event.preventDefault();
      commitAction(event);
    } else if (cancelAction && event.key == 'Escape') {
      event.preventDefault();
      cancelAction(event);
    }
  };

  useEffect(() => {
    const canvas = logotype.current;
    const context = canvas.getContext('2d');
    const roughCanvas = rough.canvas(canvas);
    const id = setInterval(() => {
      context.clearRect(0, 0, canvas.width, canvas.height);
      roughCanvas.path(
        'M 302.633 29.495 C 271.085 36.028, 255.983 50.952, 248.401 83.090 C 246.837 89.720, 246.612 98.498, 246.269 166.444 C 246.038 212.108, 246.288 247.794, 246.897 255.944 C 248.676 279.766, 254.285 294.287, 266.470 306.611 C 274.801 315.037, 282.262 319.122, 295.922 322.737 C 304.208 324.929, 307.659 325.277, 321.500 325.319 C 343.312 325.384, 357.834 321.864, 370.536 313.432 C 381.390 306.228, 391.879 291.048, 395.384 277.472 C 397.976 267.429, 398.995 246.552, 398.998 203.412 L 399 162.324 361.792 161.670 C 341.327 161.311, 324.219 161.381, 323.773 161.827 C 323.327 162.273, 323.083 172.957, 323.231 185.569 L 323.500 208.500 335.250 208.782 L 347 209.063 347 233.589 C 347 248.864, 346.563 259.850, 345.841 262.716 C 344.300 268.838, 338.838 274.300, 332.716 275.841 C 317.502 279.672, 304.807 274.250, 301.510 262.515 C 299.595 255.696, 298.872 201.141, 299.920 142.500 C 300.681 99.979, 300.843 97.193, 302.865 91.934 C 306.642 82.114, 311.626 78.972, 323.315 79.044 C 334.883 79.115, 340.337 81.824, 344.218 89.429 C 345.876 92.677, 346.400 96.663, 347.241 112.429 C 347.801 122.918, 348.538 131.805, 348.880 132.178 C 349.221 132.551, 357.600 131.810, 367.500 130.530 C 377.400 129.251, 388.650 127.821, 392.500 127.352 L 399.500 126.500 399.252 123.500 C 399.115 121.850, 398.551 112.128, 397.998 101.896 C 396.591 75.845, 393.799 65.912, 384.355 53.354 C 376.434 42.821, 364.038 35.074, 348.378 30.868 C 338.118 28.112, 312.956 27.357, 302.633 29.495 M 1420.644 29.536 C 1392.645 34.817, 1374.677 51.168, 1367.938 77.500 C 1365.379 87.503, 1364.363 107.634, 1365.881 118.290 C 1367.364 128.700, 1372.457 141.906, 1378.510 151.035 C 1384.517 160.094, 1398.325 174.091, 1410.500 183.462 C 1441.964 207.678, 1451.172 216.196, 1457.708 227.133 C 1463.722 237.196, 1465.102 248.518, 1461.870 261.263 C 1460.652 266.065, 1455.819 271.589, 1451.700 272.885 C 1437.751 277.276, 1426.511 273.698, 1421.341 263.219 C 1418.954 258.383, 1418.693 256.596, 1418.226 241.969 L 1417.716 226 1410.608 226.006 C 1401.451 226.015, 1367.126 228.804, 1365.754 229.652 C 1364.361 230.513, 1365.507 254.393, 1367.545 266.973 C 1369.471 278.857, 1374.108 292.843, 1377.995 298.493 C 1389.464 315.163, 1416.351 324.333, 1448.610 322.578 C 1480.399 320.848, 1500.459 309.587, 1510.965 287.574 C 1516.672 275.616, 1517.486 270.617, 1517.493 247.500 C 1517.501 223.624, 1516.735 219.326, 1509.936 205.064 C 1501.645 187.675, 1491.866 177.321, 1464.500 156.952 C 1444.918 142.378, 1425.593 124.238, 1422.469 117.500 C 1420.174 112.549, 1419.286 97.354, 1420.935 91.237 C 1422.341 86.022, 1427.103 80.402, 1431.767 78.453 C 1436.949 76.288, 1448.225 76.564, 1452.945 78.972 C 1460.893 83.027, 1462.492 87.153, 1463.517 106.250 L 1464.201 119 1470.851 118.937 C 1481.216 118.838, 1514.844 116.489, 1515.516 115.817 C 1516.563 114.771, 1516.145 90.315, 1514.971 83.838 C 1513.310 74.682, 1508.581 62.531, 1503.853 55.275 C 1495.936 43.122, 1484.242 35.119, 1468.118 30.819 C 1457.885 28.089, 1432.022 27.391, 1420.644 29.536 M 967.247 176.250 L 967.500 321.500 993.500 321.146 C 1007.800 320.951, 1019.552 320.726, 1019.615 320.646 C 1019.875 320.314, 1020.986 239.940, 1020.993 220.965 L 1021 200.429 1049.578 200.836 C 1065.296 201.060, 1078.544 200.851, 1079.017 200.372 C 1079.490 199.892, 1080.196 188.416, 1080.586 174.870 L 1081.295 150.240 1051.704 149.843 C 1035.429 149.625, 1021.896 149.230, 1021.631 148.964 C 1021.366 148.699, 1021.003 133.523, 1020.824 115.240 L 1020.500 81.999 1054.717 81.999 L 1088.933 82 1089.217 56.915 C 1089.372 43.119, 1089.313 31.644, 1089.083 31.415 C 1088.854 31.187, 1061.290 31, 1027.830 31 L 966.993 31 967.247 176.250 M 1113 176 L 1113 321 1139.500 321 L 1166 321 1166 176 L 1166 31 1139.500 31 L 1113 31 1113 176 M 1195.478 32.036 C 1195.125 32.606, 1194.982 97.863, 1195.158 177.052 L 1195.478 321.032 1221.989 320.766 L 1248.500 320.500 1248.758 264.750 L 1249.017 209 1257.890 209 L 1266.763 209 1267.774 213.250 C 1268.331 215.588, 1274.569 240.857, 1281.636 269.405 L 1294.486 321.309 1321.391 320.674 C 1336.188 320.324, 1348.478 319.855, 1348.701 319.633 C 1348.923 319.410, 1345.935 308.264, 1342.061 294.864 C 1338.186 281.464, 1332.955 263.300, 1330.437 254.500 C 1327.919 245.700, 1323.578 230.850, 1320.792 221.500 C 1318.005 212.150, 1315.538 203.600, 1315.309 202.500 C 1314.978 200.912, 1316.080 199.885, 1320.661 197.515 C 1328.451 193.484, 1337.442 184.515, 1340.385 177.839 C 1346.436 164.113, 1348.774 138.564, 1347.070 104.762 C 1345.839 80.322, 1344.415 72.323, 1339.528 62.392 C 1333.153 49.434, 1317.136 36.855, 1303.438 34.047 C 1292.279 31.760, 1275.701 31, 1236.953 31 C 1209.859 31, 1195.903 31.349, 1195.478 32.036 M 1529.667 31.667 C 1528.817 32.517, 1528.791 70.194, 1529.636 76.360 L 1530.272 81 1546.386 81.006 C 1555.249 81.009, 1566.213 81.301, 1570.750 81.654 L 1579 82.296 1579 148.984 C 1579 185.662, 1579.299 239.370, 1579.664 268.335 L 1580.327 321 1606.664 321 L 1633 321 1633 201.654 L 1633 82.309 1645.750 81.658 C 1652.763 81.301, 1663.563 81.006, 1669.750 81.004 L 1681 81 1681 56 L 1681 31 1605.667 31 C 1564.233 31, 1530.033 31.300, 1529.667 31.667 M 121.077 34.298 C 120.596 35.561, 116.805 55.249, 112.652 78.048 C 98.115 157.847, 91.879 191.756, 85.905 223.500 C 72.956 292.301, 68 319.333, 68.282 319.615 C 68.513 319.846, 116.944 320.238, 121.635 320.046 C 122.259 320.021, 123.091 317.413, 123.483 314.250 C 125.225 300.209, 129.839 273.761, 130.695 272.905 C 131.247 272.353, 141.345 272.074, 155.069 272.231 L 178.500 272.500 178.802 275.500 C 179.143 278.883, 184.724 314.078, 185.561 318.126 L 186.105 320.753 212.802 320.248 C 227.486 319.970, 239.654 319.610, 239.842 319.447 C 240.151 319.178, 232.364 276.713, 217.481 197.500 C 214.485 181.550, 210.423 159.275, 208.454 148 C 206.486 136.725, 203.152 118.500, 201.044 107.500 C 198.936 96.500, 195.058 75.575, 192.425 61 C 189.793 46.425, 187.215 33.938, 186.697 33.250 C 185.978 32.296, 178.206 32, 153.853 32 L 121.950 32 121.077 34.298 M 422.993 32.750 C 422.990 33.163, 422.877 97.733, 422.743 176.239 C 422.542 294.352, 422.730 319.066, 423.832 319.489 C 424.564 319.770, 451.399 320, 483.465 320 L 541.767 320 542.370 317.750 C 542.701 316.512, 542.979 305.110, 542.986 292.410 L 543 269.320 517.750 268.712 C 503.863 268.378, 489.012 268.365, 484.750 268.684 L 477 269.264 477 235.061 L 477 200.859 504.850 201.179 L 532.700 201.500 533.378 177.200 C 533.751 163.835, 533.792 152.473, 533.469 151.950 C 533.121 151.387, 521.524 151, 504.967 151 L 477.052 151 476.776 117.416 C 476.624 98.944, 476.687 83.644, 476.917 83.416 C 477.146 83.187, 492.108 83, 510.167 83 L 543 83 543 57.500 L 543 32 483 32 C 450 32, 422.997 32.337, 422.993 32.750 M 565 176.002 L 565 320.034 590.680 319.767 L 616.359 319.500 616.173 271.500 C 616.070 245.100, 615.764 209.775, 615.492 193 C 615.028 164.345, 615.096 162.712, 616.615 166 C 618.897 170.937, 629.257 200.905, 650.407 263.748 C 660.448 293.585, 668.875 318.209, 669.135 318.468 C 669.649 318.983, 723.036 319.321, 723.483 318.813 C 723.634 318.641, 724.083 254.581, 724.481 176.457 C 725.116 51.820, 725.024 34.265, 723.728 33.189 C 722.631 32.279, 715.982 32.033, 697.876 32.232 L 673.500 32.500 673.818 112 C 674.029 164.708, 673.802 191.163, 673.142 190.500 C 672.102 189.454, 653.692 128.927, 638.012 75 C 632.975 57.675, 628.061 41.025, 627.094 38 L 625.334 32.500 595.167 32.235 L 565 31.971 565 176.002 M 741.450 33.270 C 741.182 33.968, 741.084 45.331, 741.231 58.520 L 741.500 82.500 765.250 82.768 L 789 83.036 789.039 99.268 C 789.060 108.196, 789.230 161.400, 789.416 217.500 L 789.755 319.500 815.127 320.006 C 829.082 320.284, 841.063 320.348, 841.750 320.149 C 842.722 319.867, 843.027 310.313, 843.122 277.143 C 843.188 253.689, 843.386 200.525, 843.560 159 L 843.877 83.500 867.188 83 L 890.500 82.500 890.767 57.250 L 891.034 32 816.486 32 C 757.150 32, 741.838 32.259, 741.450 33.270 M 1254.250 80.737 L 1249 81.105 1249 120.421 L 1249 159.738 1252.750 160.358 C 1254.813 160.699, 1261.946 160.983, 1268.602 160.989 C 1279.512 160.999, 1281.034 160.778, 1284.048 158.747 C 1291.563 153.682, 1293.117 146.912, 1293.122 119.222 C 1293.126 95.801, 1292.114 90.387, 1286.791 85.370 C 1284.981 83.664, 1281.970 81.758, 1280.101 81.134 C 1276.907 80.068, 1266.167 79.904, 1254.250 80.737 M 152.607 123.188 C 151.338 129.483, 137.971 211.395, 137.349 216.689 L 136.725 222 153.971 222 L 171.217 222 170.712 219.750 C 170.435 218.512, 166.710 195.900, 162.435 169.500 C 158.160 143.100, 154.350 121.134, 153.969 120.688 C 153.587 120.241, 152.975 121.366, 152.607 123.188',
        {
          stroke: '#002387',
          fill: '#4169e1',
          strokeWidth: 4,
          bowing: 2,
          roughness: 2,
          hachureAngle: -40
        }
      );
    }, ui.logoRefreshMs);

    return () => {
      clearInterval(id);
    };
  }, []);

  useEffect(() => {
    let link = document.getElementById(modeId);

    if (!link) {
      link = document.createElement('link');
      link.rel = 'stylesheet';
      link.id = modeId;

      document.head.appendChild(link);
    }

    link.href = `atom-one-${colorMode}${import.meta.env.PROD ? '.min' : ''}.css`;
  }, [colorMode]);

  return (
    <Flex mx='auto' w={ui.scrollingWidth} minH='100vh'>
      <Box w='100%' maxW='100%'>
        <canvas
          ref={logotype}
          width='1760'
          height='352'
          style={{ width: '25%', minWidth: '256px' }}
        />
        <Flex
          pos='absolute'
          top={ui.navPosition}
          right={ui.navPosition}
          align='center'
          fontWeight={ui.controlFontWeight}
        >
          <Tooltip mr='1' p={ui.tooltipPadding} label={modeLabel} hasArrow>
            <IconButton
              variant='monochrome'
              icon={isLightMode ? <MoonIcon /> : <SunIcon sx={{ g: { strokeWidth: 3 } }} />}
              fontSize='sm'
              aria-label={modeLabel}
              onClick={toggleColorMode}
            />
          </Tooltip>
        </Flex>
      </Box>
    </Flex>
  );
}
